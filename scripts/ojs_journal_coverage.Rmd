---
title: "OJS Usage Statistics"
date: "Updated: `r format(Sys.Date(), format='%B %d, %Y')`"
author: "Public Knowledge Project"
output:
  html_document:
    toc: true
    toc_depth: 6
    number_sections: false
---

```{r setup, include=FALSE}
# knitr options
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.retina = 4)
```


```{r message=FALSE, warning=FALSE}
# Libraries
pacman::p_load(tidyverse, countrycode, sf, state, htmltools, htmlwidgets, urltools, janitor, DT, RColorBrewer, plotly, readxl, ggforce, skimr)

tld <- read_csv(here::here("data/tld-country.csv"))
tld_from_ip <- read_csv(here::here("data/tld_from_ip.csv"))

# world map shapefile
shapefile <-
  read_sf(here::here("data/TM_WORLD_BORDERS_SIMPL-0.3.shp")) %>%
  clean_names()

# Beacon Data
df <- read_csv(here::here("data/report.csv"))
```

<br/>

---

Our related publication can be accessed [here](https://doi.org/10.1162/qss_a_00228), and our public dataset is available for download [here](https://doi.org/10.7910/DVN/OCZNVY).

---

<br/>

# Global Statistics

```{r}
canada.states <- 
  c("Alberta", "British Columbia", "Labrador", "Manitoba", "New Brunswick", "Newfoundland", "Nova Scotia", "Nunavut", "North West Terr.", "Ontario", "Prince Edward Is.", "Québec (Province)", "Saskatchewan", "Yukon")

# correcting some oai urls
df <- 
  df %>% 
  mutate(oai_url = if_else(str_detect(oai_url, "^//"), str_c("http:", oai_url), oai_url))


# getting domain and tld
df <-  
  bind_cols(
    df,
    df %>% pull(oai_url) %>% domain() %>% tld_extract()
  ) %>% 
  mutate(country_consolidated = str_to_lower(country_consolidated) %>% str_trim()) %>% 
  left_join(tld, by = c("country_consolidated" = "tld"))

# Cleaning countries + Mapping countries to continents
df <-
  df %>% 
  mutate(
    country = country_clean,
    ojs_v2 = str_detect(version, "^2"),
    ojs_v3 = str_detect(version, "^3"),
    version_clean = case_when(
      ojs_v2 ~ "Version 2",
      ojs_v3 ~ "Version 3",
      TRUE ~ NA_character_
    )
  ) %>% 
  mutate(
    country = if_else(country == "Washington (State)", "United States", country),
    country = if_else(str_detect(country, "United States|New York|District of Columbia"), "United States", country),
    country = if_else(country %in% state.name, "United States", country),
    country = if_else(country %in% canada.states, "Canada", country),
    country = if_else(str_detect(country, "China"), "China", country),
    country = if_else(str_detect(country, "Armenia"), "Armenia", country),
    country = if_else(str_detect(country, "Georgia"), "Georgia", country),
    country = if_else(str_detect(country, "Australia|New South Wales|Queensland|Victoria"), "Australia", country),
    country = if_else(str_detect(country, "England|British"), "United Kingdom", country),
    country = if_else(str_detect(country, "Russia|Soviet Union"), "Russia", country),
    country = if_else(str_detect(country, "Palestine"), "Palestine", country),
    country = if_else(country == "Korea (South)", "South Korea", country)
  ) %>% 
  select(-country_clean)

continents <-
  df %>%
  pull(country) %>% 
  countrycode(origin = "country.name", destination = "continent")

df <- df %>% bind_cols(continents)

# rename last column to `continent`
names(df)[length(names(df))] <- "continent"

df <-
  df %>%
  separate(oai_url, c("url1", "url2"), "\n") %>% 
  rename(oai_url = url1) %>%
  select(-url2) %>% 
  filter(!str_detect(oai_url, "\\?page=")) %>%
  mutate(
    url = str_replace(oai_url, "index/oai", set_spec),
    url = str_replace(url, "^https://", ""),
    url = str_replace(url, "^http://", ""),
    url = str_replace(url, "^www108.", ""),
    url = str_replace(url, "^www5.", ""),
    url = str_replace(url, "^www3.", ""),
    url = str_replace(url, "^www2.", ""),
    url = str_replace(url, "^www.", ""),
  ) %>%
  bind_rows(
    df %>%
      separate(oai_url, c("url1", "url2"), "\n") %>%
      rename(oai_url = url1) %>%
      select(-url2) %>%
      filter(str_detect(oai_url, "\\?page=")) %>%
      mutate(
        url = str_replace(oai_url, "oai$", set_spec),
        url = str_replace(url, "^https://", ""),
        url = str_replace(url, "^http://", ""),
        url = str_replace(url, "^www108.", ""),
        url = str_replace(url, "^www5.", ""),
        url = str_replace(url, "^www3.", ""),
        url = str_replace(url, "^www2.", ""),
        url = str_replace(url, "^www.", ""),
      )
  )
```


```{r, eval=FALSE}
cols_to_keep <- read_csv("~/Downloads/beacon.csv") %>% colnames() # get cols from last year's file

df %>% 
  select(cols_to_keep, country, record_count_2024) %>%  
  arrange(country, -record_count_2024) %>%
  select(-country_marc, -country_issn, -country_tld, -country_ip, -country_consolidated, -record_count_2020, -record_count_2021, -record_count_2022, -record_count_2023) %>%
  relocate(context_name, issn, oai_url, application, country, total_record_count, record_count_2024)
  #write_csv("~/Desktop/beacon_11.19.2025.csv")
```


```{r}
# active ojs journals
df_2024 <-
  df %>%
  filter(total_record_count > 0, total_record_count >= record_count_2024, application == "ojs") %>%
  distinct(oai_url, repository_name, set_spec, .keep_all = T) %>%
  mutate(active = (record_count_2024 >= 5)) %>%
  filter(active)

n_active_journals <- nrow(df_2024)
```

<br/>

Total Active Journals using OJS in 2024: __`r format(n_active_journals, big.mark = ",", scientific = FALSE)`__. A journal is defined as 'active' if it has 5 or more records/articles published in a calendar year.

<br/>

## Global Presence Map

**Active OJS Global Presence in 2024**

```{r, fig.retina=4, out.width="100%"}
# global df
df_world <-
  df_2024 %>%
  drop_na(country) %>%
  count(country, name = "total")

labels <- function(x) {
  if_else(x < 500, as.character(x), "500+")
}

shapefile %>% 
  clean_names() %>%
  rename(country = name) %>%
  mutate(
    country = if_else(country == "Libyan Arab Jamahiriya", "Libya", country),
    country = if_else(country == "United Republic of Tanzania", "Tanzania", country),
    country = if_else(country == "Cote d'Ivoire", "Côte d'Ivoire", country),
    country = if_else(country == "Congo", "Republic of the Congo", country),
    country = if_else(country == "Viet Nam", "Vietnam", country),
    country = if_else(str_detect(country, "Iran"), "Iran", country),
    country = if_else(str_detect(country, "Korea, Republic of"), "South Korea", country),
    country = if_else(str_detect(country, "Korea, Democratic People's Republic of"), "North Korea", country),
    country = if_else(str_detect(country, "Surinam"), "Surinam", country)
  ) %>%
  left_join(df_world, by = "country") %>%
  filter(total > 0 | area > 1000) %>% 
  filter(country != "Antarctica") %>% 
  mutate(
    total = replace_na(total, 0),
    total = pmin(total, 500)
  ) %>%
  ggplot() +
  geom_sf(aes(fill = total), lwd = 0, color = "gray", show.legend = T) +
  scale_fill_gradientn(
    breaks = seq(0, 500, 100),
    labels = labels,
    colors = RColorBrewer::brewer.pal(n = 9, name = "Blues")
  ) +
  guides(
    fill =
      guide_colorbar(
        barheight = 0.5,
        barwidth = 15,
        title = "Journals",
        title.vjust = 1,
      )
  ) +
  theme_void() +
  theme(legend.position = "bottom")
```



```{r, eval=F, fig.retina=4, out.width="100%"}
# map for OJS website footer
shapefile %>% 
  clean_names() %>%
  rename(country = name) %>%
  mutate(
    country = if_else(country == "Libyan Arab Jamahiriya", "Libya", country),
    country = if_else(country == "United Republic of Tanzania", "Tanzania", country),
    country = if_else(country == "Cote d'Ivoire", "Côte d'Ivoire", country),
    country = if_else(country == "Congo", "Republic of the Congo", country),
    country = if_else(country == "Viet Nam", "Vietnam", country),
    country = if_else(str_detect(country, "Iran"), "Iran", country),
    country = if_else(str_detect(country, "Korea, Republic of"), "South Korea", country),
    country = if_else(str_detect(country, "Korea, Democratic People's Republic of"), "North Korea", country),
    country = if_else(str_detect(country, "Surinam"), "Surinam", country)
  ) %>%
  left_join(df_world, by = "country") %>%
  filter(total > 0 | area > 1000) %>% 
  filter(country != "Antarctica") %>% 
  mutate(
    total = replace_na(total, 0),
    total = pmin(total, 500)
  ) %>%
  ggplot() +
  geom_sf(aes(fill = total), lwd = 0, show.legend = T) +
  scale_fill_gradientn(
    breaks = seq(0, 500, 100),
    labels = labels,
    colors = gray.colors(9, start = 0.3, end = 0.9, gamma = 2.2),
  ) +
  guides(
    fill =
      guide_colorbar(
        barheight = 0.6,
        barwidth = 20,
        title = "Journals",
        title.vjust = 1,
      )
  ) +
  theme_void() +
  theme(legend.position = "bottom") +
  theme(legend.text=element_text(size=12, color = "white"), legend.title=element_text(size=14, color = "white"))
```


<br/>

## Active Journals using OJS in 2024 by Country

```{r}
df_world %>% 
  arrange(-total) %>%
  mutate(percent = round((total * 100)/sum(total, na.rm = T), 2) %>% str_c("%")) %>% 
  clean_names(case = "title") %>% 
  rename(`Active OJS Journals in 2024` = Total) %>% 
  DT::datatable(options = list(pageLength = 10))
```


<br/>

## Active Journals using OJS in 2024 by Region

```{r}
df_2024 %>%
  drop_na(country) %>%
  tabyl(`region`) %>% 
  as_tibble() %>% 
  arrange(-n) %>% 
  transmute(Region = `region`, Total = n, Percent = str_c(round(percent * 100, 2), "%")) %>%
  DT::datatable(options = list(pageLength = 10))
```


<br/>

## Active journal growth


```{r, fig.retina=4, out.width="100%"}
df %>% 
  select(context_name, record_count_2020:record_count_2024) %>% 
  pivot_longer(cols = starts_with("record_count")) %>% 
  mutate(
    name = parse_number(name)
  ) %>% 
  filter(value >= 5) %>% 
  count(name) %>%
  mutate(name = as.integer(name)) %>% 
  ggplot(aes(name, n)) +
  geom_col() +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2020, 2024, 1)) +
  scale_y_continuous(breaks = seq(0, 60000, 5000), minor_breaks = NULL) +
  theme(
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 10),
    axis.ticks = element_blank(),
    plot.title = element_text(hjust = 0.5)
  ) +
  labs(
    x = "Year",
    y = "Journals",
  )
```



<br/>

## Articles published [2020-24]

```{r}
total_records <-
  df %>%
  select(record_count_2020:record_count_2024) %>% 
  pivot_longer(cols = starts_with("record_count")) %>% 
  mutate(
    name = parse_number(name)
  ) %>%
  filter(value >= 5) %>%
  group_by(name) %>% 
  summarize(value = sum(value, na.rm = T)) %>% 
  summarize_all(sum) %>% 
  pull(value)
```

<br/>

Total articles published in active OJS journals [2020-24]: __`r format(total_records, big.mark = ",", scientific = FALSE)`__. This excludes articles published in less actively publishing journals, or published before 2020.

<br/>

```{r, fig.retina=4, out.width="100%"}
df %>%
  select(record_count_2020:record_count_2024) %>% 
  pivot_longer(cols = starts_with("record_count")) %>% 
  mutate(
    name = parse_number(name)
  ) %>% 
  filter(value >= 5) %>%
  group_by(name) %>% 
  summarize(value = sum(value, na.rm = T)) %>%
  ggplot(aes(name, value)) +
  geom_col() +
  scale_x_continuous(breaks = seq(2020, 2024, 1)) +
  scale_y_continuous(breaks = scales::breaks_width(250000), minor_breaks = NULL) +
  theme_minimal() +
  labs(
    x = "Year",
    y = "Articles per year",
    title = "Articles published per year in active OJS journals"
  )
```



## Average articles per active OJS journal


```{r}
df %>%
  select(record_count_2020:record_count_2024) %>% 
  pivot_longer(cols = starts_with("record_count")) %>% 
  mutate(
    name = parse_number(name)
  ) %>% 
  filter(value >= 5) %>%
  group_by(name) %>% 
  summarize(
    journals = n(),
    records = sum(value, na.rm = T)
  ) %>% 
  mutate(
    articles_per_journal = records/journals
  ) %>% 
  ggplot(aes(name, articles_per_journal)) +
  geom_line() +
  geom_point() +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2020, 2024, 1)) +
  scale_y_continuous(limits = c(0, 60), breaks = seq(0, 50, 5), minor_breaks = NULL) +
  labs(
    x = "Year",
    y = "Average Articles per Journal"
  )
```

-----

<br/><br/>

# List of Journals actively using OJS

The list is sorted by country and record count in 2024 by default.

```{r}
df_2024 %>% 
  mutate(
    url = str_c('<a href="http://', url, '" target="_blank">', url, '</a>')
  ) %>%
  arrange(country, -record_count_2024) %>%
  mutate(
    version = str_sub(version, 1, 3),
    version = if_else(str_detect(version, "^[23]"), version, NA_character_),
  ) %>%
  transmute(
    journal = context_name, 
    country = as_factor(country) %>% fct_inorder(), 
    url, 
    record_count_2024 = as.integer(record_count_2024), 
    total_record_count = as.integer(total_record_count), 
    version = fct_relevel(version, '3.5', '3.4', '3.3', '3.2', '3.1', '3.0', '2.4', '2.3', '2.2'),
  ) %>%
  clean_names(case = "title") %>% 
  rename(`OJS Version` = Version, URL = Url) %>% 
  DT::datatable(escape = F, options = list(pageLength = 25), filter = 'top')
```



